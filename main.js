/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var __defProp = Object.defineProperty;
var __getOwnPropDesc = Object.getOwnPropertyDescriptor;
var __getOwnPropNames = Object.getOwnPropertyNames;
var __hasOwnProp = Object.prototype.hasOwnProperty;
var __export = (target, all) => {
  for (var name in all)
    __defProp(target, name, { get: all[name], enumerable: true });
};
var __copyProps = (to, from, except, desc) => {
  if (from && typeof from === "object" || typeof from === "function") {
    for (let key of __getOwnPropNames(from))
      if (!__hasOwnProp.call(to, key) && key !== except)
        __defProp(to, key, { get: () => from[key], enumerable: !(desc = __getOwnPropDesc(from, key)) || desc.enumerable });
  }
  return to;
};
var __toCommonJS = (mod) => __copyProps(__defProp({}, "__esModule", { value: true }), mod);

// main.ts
var main_exports = {};
__export(main_exports, {
  default: () => OrdenarArchivosPlugin
});
module.exports = __toCommonJS(main_exports);
var import_obsidian = require("obsidian");
var Metrica = class {
  constructor(nombre, esAscendiente) {
    this.nombre = nombre;
    this.esAscendiente = esAscendiente;
  }
};
var DEFAULT_SETTINGS = {
  metricas: [],
  esAscendientes: []
};
var OrdenarArchivosPlugin = class extends import_obsidian.Plugin {
  constructor() {
    super(...arguments);
    this.settings = [];
  }
  async onload() {
    await this.loadSettings();
    this.app.workspace.onLayoutReady(() => {
      var _a;
      this.dv = (_a = this.app.plugins.plugins["dataview"]) == null ? void 0 : _a.api;
    });
    for (let metrica of this.settings) {
      this.agregarMetrica(metrica.nombre, metrica.esAscendiente);
    }
    this.registerDomEvent(document, "keydown", async (event) => {
      if (event.code == "KeyL" && this.modal) {
        await this.modal.establecerComparacion("der");
      } else if (event.code == "KeyJ" && this.modal) {
        await this.modal.establecerComparacion("izq");
      }
    });
    this.addSettingTab(new SampleSettingTab(this.app, this));
  }
  onunload() {
  }
  async loadSettings() {
    let resultado = Object.assign({}, DEFAULT_SETTINGS, await this.loadData());
    for (let [indice, metrica] of resultado.metricas.entries()) {
      let esAscendiente = indice < resultado.esAscendientes.length ? resultado.esAscendientes[indice] : false;
      if (this.settings.findIndex((objMetrica) => objMetrica.nombre == metrica) < 0)
        this.settings.push(new Metrica(metrica, esAscendiente));
    }
  }
  async saveSettings() {
    let settings = DEFAULT_SETTINGS;
    for (let metrica of this.settings) {
      settings.metricas.push(metrica.nombre);
      settings.esAscendientes.push(metrica.esAscendiente);
    }
    await this.saveData(settings);
  }
  agregarMetrica(metrica, esAscendiente) {
    this.addCommand({
      id: `open-reordenar-${this.tenerMetricaId(metrica)}`,
      name: `Reordenar ${metrica}`,
      callback: async () => {
        if (this.modal) {
          await this.modal.onClose();
          this.modal.close();
        }
        this.modal = new ReordenarModal(this.app, this.dv, metrica, esAscendiente);
        await this.modal.open();
      }
    });
  }
  eliminarMetrica(metrica) {
    this.removeCommand(`open-reordenar-${this.tenerMetricaId(metrica)}`);
  }
  tenerMetricaId(metrica) {
    metrica = metrica.trim();
    let resultado = "";
    for (let i = 0; i < metrica.length; i++) {
      resultado += metrica[i] == " " ? "-" : metrica.charAt(i);
    }
    return resultado;
  }
};
var ReordenarModal = class extends import_obsidian.Modal {
  constructor(app, dv, metrica, esAscendente) {
    super(app);
    this.metrica = metrica;
    this.esAscendente = esAscendente;
    this.component = new import_obsidian.Component();
    this.archivos = dv.pages().filter((archivo) => archivo[this.metrica]).sort((archivo) => archivo[this.metrica]).map((archivo) => ({
      path: archivo.file.path,
      name: archivo.file.name,
      metrica: archivo[metrica]
    }));
    this.ultima = [];
  }
  async onOpen() {
    const { contentEl } = this;
    this.component.load();
    this.setTitle(`Seleccionar cual es mejor seg\xFAn "${this.metrica}"`);
    this.modalEl.addClass("ordenar-ventana");
    [this.indiceIzq, this.indiceDer] = this.conseguirArchivos();
    let [archivoUno, archivoDos] = [this.indiceDer, this.indiceIzq].map((indice) => this.archivos[indice]);
    let [tArchivoUno, tArchivoDos] = [archivoUno, archivoDos].map((archivo) => this.app.vault.getAbstractFileByPath(archivo.path));
    let [contenidoUno, contenidoDos] = (await Promise.all([
      this.app.vault.read(tArchivoUno),
      this.app.vault.read(tArchivoDos)
    ])).map((contenido) => this.sacarFrontmatter(contenido));
    let separacion = contentEl.createDiv();
    separacion.addClass("ordenar-separacion");
    let divIzquierda = new import_obsidian.ButtonComponent(separacion).setClass("ordenar-archivo").onClick(async () => await this.establecerComparacion("izq")).buttonEl;
    let tareaIzquierda = import_obsidian.MarkdownRenderer.render(
      this.app,
      `# ${archivoUno.name}
---
${contenidoUno}`,
      divIzquierda.createDiv({ cls: "ordenar-archivo-contenido" }),
      archivoUno.path,
      this.component
    );
    let divDerecha = new import_obsidian.ButtonComponent(separacion).setClass("ordenar-archivo").onClick(async () => await this.establecerComparacion("der")).buttonEl;
    let tareaDerecha = import_obsidian.MarkdownRenderer.render(
      this.app,
      `# ${archivoDos.name}
---
${contenidoDos}`,
      divDerecha.createDiv({ cls: "ordenar-archivo-contenido" }),
      archivoDos.path,
      this.component
    );
    await Promise.all([tareaIzquierda, tareaDerecha]);
  }
  async onClose() {
    const { contentEl } = this;
    contentEl.empty();
    this.component.unload();
    if (!this.ultima)
      return;
    let tareas = this.ultima.map((indice) => this.archivos[indice]).map(({ path, name, metrica }) => {
      let tArchivo = this.app.vault.getAbstractFileByPath(path);
      return this.app.fileManager.processFrontMatter(tArchivo, (frontmatter) => {
        frontmatter[this.metrica] = metrica;
      });
    });
    await Promise.all(tareas);
  }
  async establecerComparacion(dir) {
    let indiceMejor = dir == "der" ? this.indiceDer : this.indiceIzq;
    let indicePeor = dir == "der" ? this.indiceIzq : this.indiceDer;
    let metricaMejor = this.archivos[indiceMejor].metrica;
    let metricaPeor = this.archivos[indicePeor].metrica;
    if (this.debeCambiar(parseInt(metricaMejor, 10), parseInt(metricaPeor, 10))) {
      this.archivos[indiceMejor]["metrica"] = metricaPeor;
      this.archivos[indicePeor]["metrica"] = metricaMejor;
    }
    await this.onClose();
    this.onOpen();
  }
  debeCambiar(metricaMejor, metricaPeor) {
    if (this.esAscendente)
      return metricaMejor > metricaPeor;
    return metricaMejor < metricaPeor;
  }
  sacarFrontmatter(contenido) {
    if (contenido.slice(0, 3) != "---")
      return contenido;
    contenido = contenido.slice(3);
    let indice = contenido.indexOf("---");
    indice += contenido.slice(indice).indexOf("\n") + 1;
    return contenido.slice(indice);
  }
  conseguirArchivos() {
    let indicePrincipal, indiceSecundario;
    do {
      indicePrincipal = Math.floor(Math.random() * this.archivos.length);
      indiceSecundario = indicePrincipal == 0 ? 1 : indicePrincipal - 1;
    } while (this.ultima.length > 0 && (this.ultima[0] == indicePrincipal && this.ultima[1] == indiceSecundario || this.ultima[1] == indicePrincipal && this.ultima[0] == indiceSecundario));
    this.ultima[0] = indicePrincipal;
    this.ultima[1] = indiceSecundario;
    let condicion = this.esAscendente ? this.archivos[indicePrincipal].metrica < this.archivos[indiceSecundario].metrica : this.archivos[indicePrincipal].metrica > this.archivos[indiceSecundario].metrica;
    return condicion ? [indicePrincipal, indiceSecundario] : [indiceSecundario, indicePrincipal];
  }
};
var SampleSettingTab = class extends import_obsidian.PluginSettingTab {
  constructor(app, plugin) {
    super(app, plugin);
    this.plugin = plugin;
  }
  display() {
    const { containerEl } = this;
    containerEl.empty();
    containerEl.createEl("h1", { text: "Configuraci\xF3n" });
    if (!this.plugin.dv) {
      containerEl.createEl("span", { text: "No se tiene instalado Dataview" });
      return;
    }
    let posiblesMetricas = this.obtenerMetricas();
    if (posiblesMetricas.length == 0) {
      containerEl.createEl("span", { text: "No hay posibles metricas para elegir" });
      return;
    }
    if (this.plugin.settings.length > 0) {
      for (let [indice, metrica] of this.plugin.settings.entries()) {
        new import_obsidian.Setting(containerEl).setName(`Setting #${indice + 1}`).setDesc("It's a secret").addToggle(
          (toggle) => toggle.setValue(metrica.esAscendiente).setTooltip("Si se activa es ascendente").onChange(async (value) => {
            let metricaVieja = this.plugin.settings[indice];
            this.plugin.eliminarMetrica(metricaVieja.nombre);
            this.plugin.settings[indice] = new Metrica(metricaVieja.nombre, value);
            this.plugin.agregarMetrica(metricaVieja.nombre, value);
            await this.plugin.saveSettings();
          })
        ).addDropdown((dropdown) => {
          for (let otrasMetrica of posiblesMetricas) {
            if (otrasMetrica != metrica.nombre && this.plugin.settings.findIndex((m) => m.nombre == otrasMetrica) >= 0)
              continue;
            dropdown = dropdown.addOption(otrasMetrica, otrasMetrica);
          }
          return dropdown.onChange(async (value) => {
            let metricaVieja = this.plugin.settings[indice];
            this.plugin.eliminarMetrica(metricaVieja.nombre);
            this.plugin.settings[indice] = new Metrica(value, metricaVieja.esAscendiente);
            this.plugin.agregarMetrica(value, metricaVieja.esAscendiente);
            await this.plugin.saveSettings();
          }).setValue(metrica.nombre);
        });
      }
    }
    let botones = containerEl.createDiv();
    botones.addClass("ordenar-botones");
    if (this.plugin.settings.length > 0) {
      new import_obsidian.ButtonComponent(botones).setClass("ordenar-boton").setButtonText("Eliminar m\xE9trica").setTooltip("Apretar").onClick(async () => {
        new import_obsidian.Notice("Eliminando");
        let metrica = this.plugin.settings.pop();
        if (metrica && metrica.nombre.trim() != "") {
          this.plugin.eliminarMetrica(metrica.nombre);
        }
        await this.plugin.saveSettings();
        this.display();
      });
    }
    if (posiblesMetricas.length > this.plugin.settings.length) {
      new import_obsidian.ButtonComponent(botones).setClass("ordenar-boton").setButtonText("Agregar m\xE9trica").setTooltip("Apretar").onClick(async () => {
        new import_obsidian.Notice("Agregando");
        let metricaNoUsada = posiblesMetricas.find((metrica) => this.plugin.settings.findIndex((m) => m.nombre == metrica));
        this.plugin.settings.push(new Metrica(metricaNoUsada ? metricaNoUsada : "", false));
        this.plugin.agregarMetrica(metricaNoUsada ? metricaNoUsada : "", false);
        await this.plugin.saveSettings();
        this.display();
      });
    }
  }
  obtenerMetricas() {
    var _a;
    return (_a = this.plugin.dv) == null ? void 0 : _a.pages().flatMap((archivo) => Object.entries(archivo.file.frontmatter).map(([key, value]) => key)).groupBy((key) => key).filter(({ key, rows }) => rows.length > 2).map(({ key, rows }) => key).values;
  }
};
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsibWFpbi50cyJdLAogICJzb3VyY2VzQ29udGVudCI6IFsiaW1wb3J0IHsgQXBwLCBNb2RhbCwgTm90aWNlLCBQbHVnaW4sIFBsdWdpblNldHRpbmdUYWIsIFNldHRpbmcsIERyb3Bkb3duQ29tcG9uZW50LCBCdXR0b25Db21wb25lbnQsIE1hcmtkb3duUmVuZGVyZXIsIENvbXBvbmVudCB9IGZyb20gJ29ic2lkaWFuJztcblxuY2xhc3MgTWV0cmljYSB7XG5cdG5vbWJyZTogc3RyaW5nO1xuXHRlc0FzY2VuZGllbnRlOiBib29sZWFuO1xuXG5cdGNvbnN0cnVjdG9yKG5vbWJyZTogc3RyaW5nLCBlc0FzY2VuZGllbnRlOiBib29sZWFuKSB7XG5cdFx0dGhpcy5ub21icmUgPSBub21icmU7XG5cdFx0dGhpcy5lc0FzY2VuZGllbnRlID0gZXNBc2NlbmRpZW50ZTtcblx0fSBcbn1cblxuaW50ZXJmYWNlIE9yZGVuYXJBcmNoaXZvc1BsdWdpblNldHRpbmdzIHtcblx0bWV0cmljYXM6IHN0cmluZ1tdO1xuXHRlc0FzY2VuZGllbnRlczogYm9vbGVhbltdO1xufVxuXG5jb25zdCBERUZBVUxUX1NFVFRJTkdTOiBPcmRlbmFyQXJjaGl2b3NQbHVnaW5TZXR0aW5ncyA9IHtcblx0bWV0cmljYXM6IFtdLFxuXHRlc0FzY2VuZGllbnRlczogW10sXG59XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIE9yZGVuYXJBcmNoaXZvc1BsdWdpbiBleHRlbmRzIFBsdWdpbiB7XG5cdHNldHRpbmdzOiBNZXRyaWNhW10gPSBbXTtcblx0ZHY6IHVuZGVmaW5lZCB8IFBsdWdpbjtcblx0bW9kYWw6IHVuZGVmaW5lZCB8IFJlb3JkZW5hck1vZGFsO1xuXG5cdGFzeW5jIG9ubG9hZCgpIHtcblx0XHRhd2FpdCB0aGlzLmxvYWRTZXR0aW5ncygpO1xuXG5cdFx0dGhpcy5hcHAud29ya3NwYWNlLm9uTGF5b3V0UmVhZHkoKCkgPT4ge1xuXHRcdFx0dGhpcy5kdiA9IHRoaXMuYXBwLnBsdWdpbnMucGx1Z2luc1tcImRhdGF2aWV3XCJdPy5hcGk7XG5cdFx0fSlcblxuXHRcdC8vIFRoaXMgYWRkcyBhIHNpbXBsZSBjb21tYW5kIHRoYXQgY2FuIGJlIHRyaWdnZXJlZCBhbnl3aGVyZVxuXHRcdGZvciAobGV0IG1ldHJpY2Egb2YgdGhpcy5zZXR0aW5ncykge1xuXHRcdFx0dGhpcy5hZ3JlZ2FyTWV0cmljYShtZXRyaWNhLm5vbWJyZSwgbWV0cmljYS5lc0FzY2VuZGllbnRlKTtcblx0XHR9XG5cblx0XHR0aGlzLnJlZ2lzdGVyRG9tRXZlbnQoZG9jdW1lbnQsICdrZXlkb3duJywgYXN5bmMgKGV2ZW50OiBLZXlib2FyZEV2ZW50KSA9PiB7XG5cdFx0XHRpZiAoZXZlbnQuY29kZSA9PSBcIktleUxcIiAmJiB0aGlzLm1vZGFsKSB7XG5cdFx0XHRcdGF3YWl0IHRoaXMubW9kYWwuZXN0YWJsZWNlckNvbXBhcmFjaW9uKCdkZXInKTtcblx0XHRcdH0gZWxzZSBpZiAoZXZlbnQuY29kZSA9PSBcIktleUpcIiAmJiB0aGlzLm1vZGFsKSB7XG5cdFx0XHRcdGF3YWl0IHRoaXMubW9kYWwuZXN0YWJsZWNlckNvbXBhcmFjaW9uKCdpenEnKTtcblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdC8vIFRoaXMgYWRkcyBhIHNldHRpbmdzIHRhYiBzbyB0aGUgdXNlciBjYW4gY29uZmlndXJlIHZhcmlvdXMgYXNwZWN0cyBvZiB0aGUgcGx1Z2luXG5cdFx0dGhpcy5hZGRTZXR0aW5nVGFiKG5ldyBTYW1wbGVTZXR0aW5nVGFiKHRoaXMuYXBwLCB0aGlzKSk7XG5cdH1cblxuXHRvbnVubG9hZCgpIHtcblxuXHR9XG5cblx0YXN5bmMgbG9hZFNldHRpbmdzKCkge1xuXHRcdGxldCByZXN1bHRhZG86IE9yZGVuYXJBcmNoaXZvc1BsdWdpblNldHRpbmdzID0gT2JqZWN0LmFzc2lnbih7fSwgREVGQVVMVF9TRVRUSU5HUywgYXdhaXQgdGhpcy5sb2FkRGF0YSgpKTtcblxuXHRcdGZvciAobGV0IFtpbmRpY2UsIG1ldHJpY2FdIG9mIHJlc3VsdGFkby5tZXRyaWNhcy5lbnRyaWVzKCkpIHtcblx0XHRcdGxldCBlc0FzY2VuZGllbnRlID0gKGluZGljZSA8IHJlc3VsdGFkby5lc0FzY2VuZGllbnRlcy5sZW5ndGgpXG5cdFx0XHRcdD8gcmVzdWx0YWRvLmVzQXNjZW5kaWVudGVzW2luZGljZV1cblx0XHRcdFx0OiBmYWxzZTtcblx0XHRcdGlmICh0aGlzLnNldHRpbmdzLmZpbmRJbmRleChvYmpNZXRyaWNhID0+IG9iak1ldHJpY2Eubm9tYnJlID09IG1ldHJpY2EpIDwgMClcblx0XHRcdFx0dGhpcy5zZXR0aW5ncy5wdXNoKG5ldyBNZXRyaWNhKG1ldHJpY2EsIGVzQXNjZW5kaWVudGUpKTtcblx0XHR9XG5cdH1cblxuXHRhc3luYyBzYXZlU2V0dGluZ3MoKSB7XG5cdFx0bGV0IHNldHRpbmdzOiBPcmRlbmFyQXJjaGl2b3NQbHVnaW5TZXR0aW5ncyA9IERFRkFVTFRfU0VUVElOR1M7XG5cdFx0Zm9yIChsZXQgbWV0cmljYSBvZiB0aGlzLnNldHRpbmdzKSB7XG5cdFx0XHRzZXR0aW5ncy5tZXRyaWNhcy5wdXNoKG1ldHJpY2Eubm9tYnJlKTtcblx0XHRcdHNldHRpbmdzLmVzQXNjZW5kaWVudGVzLnB1c2gobWV0cmljYS5lc0FzY2VuZGllbnRlKTtcblx0XHR9XG5cdFx0YXdhaXQgdGhpcy5zYXZlRGF0YShzZXR0aW5ncyk7XG5cdH1cblxuXHRhZ3JlZ2FyTWV0cmljYShtZXRyaWNhOiBzdHJpbmcsIGVzQXNjZW5kaWVudGU6IGJvb2xlYW4pOiB2b2lkIHtcblx0XHR0aGlzLmFkZENvbW1hbmQoe1xuXHRcdFx0aWQ6IGBvcGVuLXJlb3JkZW5hci0ke3RoaXMudGVuZXJNZXRyaWNhSWQobWV0cmljYSl9YCxcblx0XHRcdG5hbWU6IGBSZW9yZGVuYXIgJHttZXRyaWNhfWAsXG5cdFx0XHRjYWxsYmFjazogYXN5bmMgKCkgPT4ge1xuXHRcdFx0XHRpZiAodGhpcy5tb2RhbCkge1xuXHRcdFx0XHRcdGF3YWl0IHRoaXMubW9kYWwub25DbG9zZSgpO1xuXHRcdFx0XHRcdHRoaXMubW9kYWwuY2xvc2UoKTtcblx0XHRcdFx0fVxuXHRcdFx0XHR0aGlzLm1vZGFsID0gbmV3IFJlb3JkZW5hck1vZGFsKHRoaXMuYXBwLCB0aGlzLmR2LCBtZXRyaWNhLCBlc0FzY2VuZGllbnRlKTtcblx0XHRcdFx0YXdhaXQgdGhpcy5tb2RhbC5vcGVuKCk7XG5cdFx0XHR9XG5cdFx0fSk7XG5cdH1cblxuXHRlbGltaW5hck1ldHJpY2EobWV0cmljYTogc3RyaW5nKTogdm9pZCB7XG5cdFx0dGhpcy5yZW1vdmVDb21tYW5kKGBvcGVuLXJlb3JkZW5hci0ke3RoaXMudGVuZXJNZXRyaWNhSWQobWV0cmljYSl9YCk7XG5cdH1cblxuXHR0ZW5lck1ldHJpY2FJZChtZXRyaWNhOiBzdHJpbmcpOiBzdHJpbmcge1xuXHRcdG1ldHJpY2EgPSBtZXRyaWNhLnRyaW0oKTtcblx0XHRsZXQgcmVzdWx0YWRvID0gXCJcIjtcblx0XHRmb3IgKGxldCBpID0gMDsgaSA8IG1ldHJpY2EubGVuZ3RoOyBpKyspIHtcblx0XHRcdHJlc3VsdGFkbyArPSAobWV0cmljYVtpXSA9PSBcIiBcIikgPyBcIi1cIiA6IG1ldHJpY2EuY2hhckF0KGkpO1xuXHRcdH1cblx0XHRyZXR1cm4gcmVzdWx0YWRvO1xuXHR9XG59XG5cblxuY2xhc3MgUmVvcmRlbmFyTW9kYWwgZXh0ZW5kcyBNb2RhbCB7XG5cdG1ldHJpY2E6IHN0cmluZztcblx0ZXNBc2NlbmRlbnRlOiBib29sZWFuO1xuXG5cdGNvbXBvbmVudDogQ29tcG9uZW50O1xuXHRhcmNoaXZvczogUmVjb3JkPHN0cmluZywgc3RyaW5nPltdO1xuXHR1bHRpbWE6IG51bWJlcltdO1xuXG5cdGluZGljZUl6cTogbnVtYmVyO1xuXHRpbmRpY2VEZXI6IG51bWJlcjtcblxuXHRjb25zdHJ1Y3RvcihhcHA6IEFwcCwgZHY6IFBsdWdpbiwgbWV0cmljYTogc3RyaW5nLCBlc0FzY2VuZGVudGU6IGJvb2xlYW4pIHtcblx0XHRzdXBlcihhcHApO1xuXHRcdHRoaXMubWV0cmljYSA9IG1ldHJpY2E7XG5cdFx0dGhpcy5lc0FzY2VuZGVudGUgPSBlc0FzY2VuZGVudGU7XG5cblx0XHR0aGlzLmNvbXBvbmVudCA9IG5ldyBDb21wb25lbnQoKTtcblx0XHR0aGlzLmFyY2hpdm9zID0gZHYucGFnZXMoKVxuXHRcdFx0LmZpbHRlcihhcmNoaXZvID0+IGFyY2hpdm9bdGhpcy5tZXRyaWNhXSlcblx0XHRcdC5zb3J0KGFyY2hpdm8gPT4gYXJjaGl2b1t0aGlzLm1ldHJpY2FdKVxuXHRcdFx0Lm1hcChhcmNoaXZvID0+ICh7IFxuXHRcdFx0XHRwYXRoOiBhcmNoaXZvLmZpbGUucGF0aCwgXG5cdFx0XHRcdG5hbWU6IGFyY2hpdm8uZmlsZS5uYW1lLCBcblx0XHRcdFx0bWV0cmljYTogYXJjaGl2b1ttZXRyaWNhXSBcblx0XHRcdH0pKTtcblx0XHR0aGlzLnVsdGltYSA9IFtdO1xuXHR9XG5cblx0YXN5bmMgb25PcGVuKCk6IFByb21pc2U8dm9pZD4ge1xuXHRcdGNvbnN0IHtjb250ZW50RWx9ID0gdGhpcztcblx0XHR0aGlzLmNvbXBvbmVudC5sb2FkKCk7XG5cblx0XHR0aGlzLnNldFRpdGxlKGBTZWxlY2Npb25hciBjdWFsIGVzIG1lam9yIHNlZ1x1MDBGQW4gXCIke3RoaXMubWV0cmljYX1cImApO1xuXHRcdHRoaXMubW9kYWxFbC5hZGRDbGFzcyhcIm9yZGVuYXItdmVudGFuYVwiKTtcblxuXHRcdFsgdGhpcy5pbmRpY2VJenEsIHRoaXMuaW5kaWNlRGVyIF0gPSB0aGlzLmNvbnNlZ3VpckFyY2hpdm9zKCk7XG5cdFx0bGV0IFsgYXJjaGl2b1VubywgYXJjaGl2b0RvcyBdID0gWyB0aGlzLmluZGljZURlciwgdGhpcy5pbmRpY2VJenEgXS5tYXAoaW5kaWNlID0+IHRoaXMuYXJjaGl2b3NbaW5kaWNlXSk7XG5cdFx0bGV0IFsgdEFyY2hpdm9Vbm8sIHRBcmNoaXZvRG9zIF0gPSBbIGFyY2hpdm9Vbm8sIGFyY2hpdm9Eb3MgXS5tYXAoYXJjaGl2byA9PiB0aGlzLmFwcC52YXVsdC5nZXRBYnN0cmFjdEZpbGVCeVBhdGgoYXJjaGl2by5wYXRoKSk7XG5cblx0XHRsZXQgWyBjb250ZW5pZG9Vbm8sIGNvbnRlbmlkb0RvcyBdID0gKGF3YWl0IFByb21pc2UuYWxsKFtcblx0XHRcdHRoaXMuYXBwLnZhdWx0LnJlYWQodEFyY2hpdm9Vbm8pLFxuXHRcdFx0dGhpcy5hcHAudmF1bHQucmVhZCh0QXJjaGl2b0Rvcylcblx0XHRdKSkubWFwKGNvbnRlbmlkbyA9PiB0aGlzLnNhY2FyRnJvbnRtYXR0ZXIoY29udGVuaWRvKSk7XG5cblx0XHRsZXQgc2VwYXJhY2lvbiA9IGNvbnRlbnRFbC5jcmVhdGVEaXYoKTtcblx0XHRzZXBhcmFjaW9uLmFkZENsYXNzKFwib3JkZW5hci1zZXBhcmFjaW9uXCIpO1xuXHRcdFxuXG5cdFx0bGV0IGRpdkl6cXVpZXJkYSA9IG5ldyBCdXR0b25Db21wb25lbnQoc2VwYXJhY2lvbilcblx0XHRcdC5zZXRDbGFzcyhcIm9yZGVuYXItYXJjaGl2b1wiKVxuXHRcdFx0Lm9uQ2xpY2soYXN5bmMgKCkgPT4gYXdhaXQgdGhpcy5lc3RhYmxlY2VyQ29tcGFyYWNpb24oJ2l6cScpKVxuXHRcdFx0LmJ1dHRvbkVsO1xuXG5cdFx0bGV0IHRhcmVhSXpxdWllcmRhID0gTWFya2Rvd25SZW5kZXJlclxuXHRcdFx0LnJlbmRlcihcblx0XHRcdFx0dGhpcy5hcHAsIGAjICR7YXJjaGl2b1Vuby5uYW1lfVxcbi0tLVxcbiR7Y29udGVuaWRvVW5vfWAsIFxuXHRcdFx0XHRkaXZJenF1aWVyZGEuY3JlYXRlRGl2KHsgY2xzOiBcIm9yZGVuYXItYXJjaGl2by1jb250ZW5pZG9cIiB9KSwgXG5cdFx0XHRcdGFyY2hpdm9Vbm8ucGF0aCwgXG5cdFx0XHRcdHRoaXMuY29tcG9uZW50XG5cdFx0XHQpO1xuXG5cdFx0bGV0IGRpdkRlcmVjaGEgPSBuZXcgQnV0dG9uQ29tcG9uZW50KHNlcGFyYWNpb24pXG5cdFx0XHQuc2V0Q2xhc3MoXCJvcmRlbmFyLWFyY2hpdm9cIilcblx0XHRcdC5vbkNsaWNrKGFzeW5jICgpID0+IGF3YWl0IHRoaXMuZXN0YWJsZWNlckNvbXBhcmFjaW9uKCdkZXInKSlcblx0XHRcdC5idXR0b25FbDtcblxuXHRcdGxldCB0YXJlYURlcmVjaGEgPSBNYXJrZG93blJlbmRlcmVyXG5cdFx0XHQucmVuZGVyKFxuXHRcdFx0XHR0aGlzLmFwcCwgYCMgJHthcmNoaXZvRG9zLm5hbWV9XFxuLS0tXFxuJHtjb250ZW5pZG9Eb3N9YCwgXG5cdFx0XHRcdGRpdkRlcmVjaGEuY3JlYXRlRGl2KHsgY2xzOiBcIm9yZGVuYXItYXJjaGl2by1jb250ZW5pZG9cIiB9KSwgXG5cdFx0XHRcdGFyY2hpdm9Eb3MucGF0aCxcblx0XHRcdFx0dGhpcy5jb21wb25lbnRcblx0XHRcdCk7XG5cblx0XHRhd2FpdCBQcm9taXNlLmFsbChbIHRhcmVhSXpxdWllcmRhLCB0YXJlYURlcmVjaGEgXSk7XG5cdH1cblxuXHRhc3luYyBvbkNsb3NlKCk6IFByb21pc2U8dm9pZD4ge1xuXHRcdGNvbnN0IHtjb250ZW50RWx9ID0gdGhpcztcblx0XHRjb250ZW50RWwuZW1wdHkoKTtcblxuXHRcdHRoaXMuY29tcG9uZW50LnVubG9hZCgpO1xuXG5cdFx0aWYgKCF0aGlzLnVsdGltYSkgcmV0dXJuO1xuXG5cdFx0bGV0IHRhcmVhcyA9IHRoaXMudWx0aW1hLm1hcChpbmRpY2UgPT4gdGhpcy5hcmNoaXZvc1tpbmRpY2VdKVxuXHRcdFx0Lm1hcCgoeyBwYXRoLCBuYW1lLCBtZXRyaWNhIH0pID0+IHtcblx0XHRcdFx0bGV0IHRBcmNoaXZvID0gdGhpcy5hcHAudmF1bHQuZ2V0QWJzdHJhY3RGaWxlQnlQYXRoKHBhdGgpO1xuXG5cdFx0XHRcdHJldHVybiB0aGlzLmFwcC5maWxlTWFuYWdlci5wcm9jZXNzRnJvbnRNYXR0ZXIodEFyY2hpdm8sIChmcm9udG1hdHRlcikgPT4ge1xuXHRcdFx0XHRcdGZyb250bWF0dGVyW3RoaXMubWV0cmljYV0gPSBtZXRyaWNhO1xuXHRcdFx0XHR9KVxuXHRcdFx0fSk7XG5cblx0XHRhd2FpdCBQcm9taXNlLmFsbCh0YXJlYXMpO1xuXHR9XG5cblx0YXN5bmMgZXN0YWJsZWNlckNvbXBhcmFjaW9uKGRpcikge1xuXHRcdGxldCBpbmRpY2VNZWpvciA9IChkaXIgPT0gJ2RlcicpID8gdGhpcy5pbmRpY2VEZXIgOiB0aGlzLmluZGljZUl6cTtcblx0XHRsZXQgaW5kaWNlUGVvciA9IChkaXIgPT0gJ2RlcicpID8gdGhpcy5pbmRpY2VJenEgOiB0aGlzLmluZGljZURlcjtcblxuXHRcdGxldCBtZXRyaWNhTWVqb3IgPSB0aGlzLmFyY2hpdm9zW2luZGljZU1lam9yXS5tZXRyaWNhO1xuXHRcdGxldCBtZXRyaWNhUGVvciA9IHRoaXMuYXJjaGl2b3NbaW5kaWNlUGVvcl0ubWV0cmljYTtcblxuXHRcdGlmICh0aGlzLmRlYmVDYW1iaWFyKHBhcnNlSW50KG1ldHJpY2FNZWpvciwgMTApLCBwYXJzZUludChtZXRyaWNhUGVvciwgMTApKSkge1xuXHRcdFx0dGhpcy5hcmNoaXZvc1tpbmRpY2VNZWpvcl1bXCJtZXRyaWNhXCJdID0gbWV0cmljYVBlb3I7XG5cdFx0XHR0aGlzLmFyY2hpdm9zW2luZGljZVBlb3JdW1wibWV0cmljYVwiXSA9IG1ldHJpY2FNZWpvcjtcblxuXHRcdH1cblxuXHRcdGF3YWl0IHRoaXMub25DbG9zZSgpO1xuXHRcdHRoaXMub25PcGVuKCk7XG5cdH1cblxuXHRkZWJlQ2FtYmlhcihtZXRyaWNhTWVqb3IsIG1ldHJpY2FQZW9yKSB7XG5cdFx0aWYgKHRoaXMuZXNBc2NlbmRlbnRlKSByZXR1cm4gbWV0cmljYU1lam9yID4gbWV0cmljYVBlb3I7XG5cdFx0cmV0dXJuIG1ldHJpY2FNZWpvciA8IG1ldHJpY2FQZW9yO1xuXHR9XG5cblx0c2FjYXJGcm9udG1hdHRlcihjb250ZW5pZG86IHN0cmluZyk6IHN0cmluZyB7XG5cdFx0aWYgKGNvbnRlbmlkby5zbGljZSgwLCAzKSAhPSBcIi0tLVwiKVxuXHRcdFx0cmV0dXJuIGNvbnRlbmlkbztcblx0XHRjb250ZW5pZG8gPSBjb250ZW5pZG8uc2xpY2UoMyk7XG5cdFx0XG5cdFx0bGV0IGluZGljZSA9IGNvbnRlbmlkby5pbmRleE9mKFwiLS0tXCIpXG5cdFx0aW5kaWNlICs9IGNvbnRlbmlkby5zbGljZShpbmRpY2UpLmluZGV4T2YoXCJcXG5cIikgKyAxO1xuXG5cdFx0cmV0dXJuIGNvbnRlbmlkby5zbGljZShpbmRpY2UpO1xuXHR9XG5cblx0Y29uc2VndWlyQXJjaGl2b3MoKSB7XG5cdFx0bGV0IGluZGljZVByaW5jaXBhbCwgaW5kaWNlU2VjdW5kYXJpbztcblxuXHRcdGRvIHtcbiAgICAgICAgXHRpbmRpY2VQcmluY2lwYWwgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiB0aGlzLmFyY2hpdm9zLmxlbmd0aCk7XG5cdFx0XHRpbmRpY2VTZWN1bmRhcmlvID0gaW5kaWNlUHJpbmNpcGFsID09IDAgPyAxIDogaW5kaWNlUHJpbmNpcGFsIC0gMTtcblxuXHRcdH0gd2hpbGUgKFxuXHRcdFx0dGhpcy51bHRpbWEubGVuZ3RoID4gMCAmJiBcblx0XHRcdCggKHRoaXMudWx0aW1hWzBdID09IGluZGljZVByaW5jaXBhbCAmJiB0aGlzLnVsdGltYVsxXSA9PSBpbmRpY2VTZWN1bmRhcmlvKSB8fFxuXHRcdFx0ICAodGhpcy51bHRpbWFbMV0gPT0gaW5kaWNlUHJpbmNpcGFsICYmIHRoaXMudWx0aW1hWzBdID09IGluZGljZVNlY3VuZGFyaW8pIClcblx0XHQpO1xuXHRcdFxuXHRcdHRoaXMudWx0aW1hWzBdID0gaW5kaWNlUHJpbmNpcGFsO1xuXHRcdHRoaXMudWx0aW1hWzFdID0gaW5kaWNlU2VjdW5kYXJpbztcblxuXHRcdGxldCBjb25kaWNpb24gPSB0aGlzLmVzQXNjZW5kZW50ZSBcblx0XHRcdD8gdGhpcy5hcmNoaXZvc1tpbmRpY2VQcmluY2lwYWxdLm1ldHJpY2EgPCB0aGlzLmFyY2hpdm9zW2luZGljZVNlY3VuZGFyaW9dLm1ldHJpY2Fcblx0XHRcdDogdGhpcy5hcmNoaXZvc1tpbmRpY2VQcmluY2lwYWxdLm1ldHJpY2EgPiB0aGlzLmFyY2hpdm9zW2luZGljZVNlY3VuZGFyaW9dLm1ldHJpY2E7XG5cblx0XHRyZXR1cm4gY29uZGljaW9uXG5cdFx0XHQ/IFtpbmRpY2VQcmluY2lwYWwsIGluZGljZVNlY3VuZGFyaW9dXG5cdFx0XHQ6IFtpbmRpY2VTZWN1bmRhcmlvLCBpbmRpY2VQcmluY2lwYWxdO1xuXG4gICAgfVxufVxuXG5jbGFzcyBTYW1wbGVTZXR0aW5nVGFiIGV4dGVuZHMgUGx1Z2luU2V0dGluZ1RhYiB7XG5cdHBsdWdpbjogT3JkZW5hckFyY2hpdm9zUGx1Z2luO1xuXG5cdGNvbnN0cnVjdG9yKGFwcDogQXBwLCBwbHVnaW46IE9yZGVuYXJBcmNoaXZvc1BsdWdpbikge1xuXHRcdHN1cGVyKGFwcCwgcGx1Z2luKTtcblx0XHR0aGlzLnBsdWdpbiA9IHBsdWdpbjtcblx0fVxuXG5cdGRpc3BsYXkoKTogdm9pZCB7XG5cdFx0Y29uc3Qge2NvbnRhaW5lckVsfSA9IHRoaXM7XG5cdFx0Y29udGFpbmVyRWwuZW1wdHkoKTtcblxuXHRcdGNvbnRhaW5lckVsLmNyZWF0ZUVsKFwiaDFcIiwgeyB0ZXh0OiBcIkNvbmZpZ3VyYWNpXHUwMEYzblwiIH0pXG5cblx0XHRpZiAoIXRoaXMucGx1Z2luLmR2KSB7XG5cdFx0XHRjb250YWluZXJFbC5jcmVhdGVFbChcInNwYW5cIiwgeyB0ZXh0OiBcIk5vIHNlIHRpZW5lIGluc3RhbGFkbyBEYXRhdmlld1wiIH0pXG5cdFx0XHRyZXR1cm47XG5cdFx0fVxuXHRcdFxuXHRcdGxldCBwb3NpYmxlc01ldHJpY2FzID0gdGhpcy5vYnRlbmVyTWV0cmljYXMoKTtcblx0XHRpZiAocG9zaWJsZXNNZXRyaWNhcy5sZW5ndGggPT0gMCkge1xuXHRcdFx0Y29udGFpbmVyRWwuY3JlYXRlRWwoXCJzcGFuXCIsIHsgdGV4dDogXCJObyBoYXkgcG9zaWJsZXMgbWV0cmljYXMgcGFyYSBlbGVnaXJcIiB9KVxuXHRcdFx0cmV0dXJuO1xuXHRcdH1cblxuXHRcdGlmICh0aGlzLnBsdWdpbi5zZXR0aW5ncy5sZW5ndGggPiAwKSB7XG5cdFx0XHRmb3IgKGxldCBbaW5kaWNlLCBtZXRyaWNhXSBvZiB0aGlzLnBsdWdpbi5zZXR0aW5ncy5lbnRyaWVzKCkpIHtcblx0XHRcdFx0bmV3IFNldHRpbmcoY29udGFpbmVyRWwpXG5cdFx0XHRcdFx0LnNldE5hbWUoYFNldHRpbmcgIyR7aW5kaWNlICsgMX1gKVxuXHRcdFx0XHRcdC5zZXREZXNjKCdJdFxcJ3MgYSBzZWNyZXQnKVxuXHRcdFx0XHRcdC5hZGRUb2dnbGUodG9nZ2xlID0+IHRvZ2dsZVxuXHRcdFx0XHRcdFx0LnNldFZhbHVlKG1ldHJpY2EuZXNBc2NlbmRpZW50ZSlcblx0XHRcdFx0XHRcdC5zZXRUb29sdGlwKFwiU2kgc2UgYWN0aXZhIGVzIGFzY2VuZGVudGVcIilcblx0XHRcdFx0XHRcdC5vbkNoYW5nZShhc3luYyAodmFsdWUpID0+IHsgXG5cdFx0XHRcdFx0XHRcdGxldCBtZXRyaWNhVmllamEgPSB0aGlzLnBsdWdpbi5zZXR0aW5nc1tpbmRpY2VdO1xuXHRcdFx0XHRcdFx0XHR0aGlzLnBsdWdpbi5lbGltaW5hck1ldHJpY2EobWV0cmljYVZpZWphLm5vbWJyZSk7XG5cblx0XHRcdFx0XHRcdFx0dGhpcy5wbHVnaW4uc2V0dGluZ3NbaW5kaWNlXSA9IG5ldyBNZXRyaWNhKG1ldHJpY2FWaWVqYS5ub21icmUsIHZhbHVlKTtcblx0XHRcdFx0XHRcdFx0dGhpcy5wbHVnaW4uYWdyZWdhck1ldHJpY2EobWV0cmljYVZpZWphLm5vbWJyZSwgdmFsdWUpO1xuXHRcdFx0XHRcdFx0XHRhd2FpdCB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKTtcblx0XHRcdFx0XHRcdH0pXG5cdFx0XHRcdFx0KVxuXHRcdFx0XHRcdC5hZGREcm9wZG93bihkcm9wZG93biA9PiB7XG5cdFx0XHRcdFx0XHRmb3IgKGxldCBvdHJhc01ldHJpY2Egb2YgcG9zaWJsZXNNZXRyaWNhcykge1xuXHRcdFx0XHRcdFx0XHRpZiAob3RyYXNNZXRyaWNhICE9IG1ldHJpY2Eubm9tYnJlICYmIHRoaXMucGx1Z2luLnNldHRpbmdzLmZpbmRJbmRleChtID0+IG0ubm9tYnJlID09IG90cmFzTWV0cmljYSkgPj0gMClcblx0XHRcdFx0XHRcdFx0XHRjb250aW51ZVxuXG5cdFx0XHRcdFx0XHRcdGRyb3Bkb3duID0gZHJvcGRvd24uYWRkT3B0aW9uKG90cmFzTWV0cmljYSwgb3RyYXNNZXRyaWNhKTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIGRyb3Bkb3duLm9uQ2hhbmdlKGFzeW5jICh2YWx1ZSkgPT4ge1xuXHRcdFx0XHRcdFx0XHRsZXQgbWV0cmljYVZpZWphID0gdGhpcy5wbHVnaW4uc2V0dGluZ3NbaW5kaWNlXTtcblx0XHRcdFx0XHRcdFx0dGhpcy5wbHVnaW4uZWxpbWluYXJNZXRyaWNhKG1ldHJpY2FWaWVqYS5ub21icmUpO1xuXG5cdFx0XHRcdFx0XHRcdHRoaXMucGx1Z2luLnNldHRpbmdzW2luZGljZV0gPSBuZXcgTWV0cmljYSh2YWx1ZSwgbWV0cmljYVZpZWphLmVzQXNjZW5kaWVudGUpO1xuXHRcdFx0XHRcdFx0XHR0aGlzLnBsdWdpbi5hZ3JlZ2FyTWV0cmljYSh2YWx1ZSwgbWV0cmljYVZpZWphLmVzQXNjZW5kaWVudGUpO1xuXHRcdFx0XHRcdFx0XHRhd2FpdCB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKTtcblx0XHRcdFx0XHRcdH0pLnNldFZhbHVlKG1ldHJpY2Eubm9tYnJlKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdH1cblx0XHR9XG5cblx0XHRsZXQgYm90b25lcyA9IGNvbnRhaW5lckVsLmNyZWF0ZURpdigpO1xuXHRcdGJvdG9uZXMuYWRkQ2xhc3MoXCJvcmRlbmFyLWJvdG9uZXNcIilcblxuXHRcdGlmICh0aGlzLnBsdWdpbi5zZXR0aW5ncy5sZW5ndGggPiAwKSB7XG5cdFx0XHRuZXcgQnV0dG9uQ29tcG9uZW50KGJvdG9uZXMpXG5cdFx0XHRcdC5zZXRDbGFzcyhcIm9yZGVuYXItYm90b25cIilcblx0XHRcdFx0LnNldEJ1dHRvblRleHQoXCJFbGltaW5hciBtXHUwMEU5dHJpY2FcIilcblx0XHRcdFx0LnNldFRvb2x0aXAoXCJBcHJldGFyXCIpXG5cdFx0XHRcdC5vbkNsaWNrKGFzeW5jICgpID0+IHtcblx0XHRcdFx0XHRuZXcgTm90aWNlKFwiRWxpbWluYW5kb1wiKVxuXHRcdFx0XHRcdGxldCBtZXRyaWNhID0gdGhpcy5wbHVnaW4uc2V0dGluZ3MucG9wKCk7XG5cdFx0XHRcdFx0aWYgKG1ldHJpY2EgJiYgbWV0cmljYS5ub21icmUudHJpbSgpICE9IFwiXCIpIHtcblx0XHRcdFx0XHRcdHRoaXMucGx1Z2luLmVsaW1pbmFyTWV0cmljYShtZXRyaWNhLm5vbWJyZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0YXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XG5cdFx0XHRcdFx0dGhpcy5kaXNwbGF5KCk7XG5cdFx0XHRcdH0pO1xuXHRcdH1cblxuXHRcdGlmIChwb3NpYmxlc01ldHJpY2FzLmxlbmd0aCA+IHRoaXMucGx1Z2luLnNldHRpbmdzLmxlbmd0aCkge1xuXHRcdFx0bmV3IEJ1dHRvbkNvbXBvbmVudChib3RvbmVzKVxuXHRcdFx0XHQuc2V0Q2xhc3MoXCJvcmRlbmFyLWJvdG9uXCIpXG5cdFx0XHRcdC5zZXRCdXR0b25UZXh0KFwiQWdyZWdhciBtXHUwMEU5dHJpY2FcIilcblx0XHRcdFx0LnNldFRvb2x0aXAoXCJBcHJldGFyXCIpXG5cdFx0XHRcdC5vbkNsaWNrKGFzeW5jICgpID0+IHtcblx0XHRcdFx0XHRuZXcgTm90aWNlKFwiQWdyZWdhbmRvXCIpXG5cdFx0XHRcdFx0bGV0IG1ldHJpY2FOb1VzYWRhID0gcG9zaWJsZXNNZXRyaWNhc1xuXHRcdFx0XHRcdFx0LmZpbmQobWV0cmljYSA9PiB0aGlzLnBsdWdpbi5zZXR0aW5ncy5maW5kSW5kZXgobSA9PiBtLm5vbWJyZSA9PSBtZXRyaWNhKSk7XG5cdFx0XHRcdFx0dGhpcy5wbHVnaW4uc2V0dGluZ3MucHVzaChuZXcgTWV0cmljYShtZXRyaWNhTm9Vc2FkYSA/IG1ldHJpY2FOb1VzYWRhIDogXCJcIiwgZmFsc2UpKTtcblx0XHRcdFx0XHR0aGlzLnBsdWdpbi5hZ3JlZ2FyTWV0cmljYShtZXRyaWNhTm9Vc2FkYSA/IG1ldHJpY2FOb1VzYWRhIDogXCJcIiwgZmFsc2UpO1xuXHRcdFx0XHRcdGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xuXHRcdFx0XHRcdHRoaXMuZGlzcGxheSgpO1xuXHRcdFx0XHR9KTtcblx0XHR9XG5cdH1cblxuXHRvYnRlbmVyTWV0cmljYXMoKTogc3RyaW5nW10ge1xuXHRcdHJldHVybiB0aGlzLnBsdWdpbi5kdj8ucGFnZXMoKVxuXHRcdFx0LmZsYXRNYXAoYXJjaGl2byA9PiBPYmplY3QuZW50cmllcyhhcmNoaXZvLmZpbGUuZnJvbnRtYXR0ZXIpXG5cdFx0XHQubWFwKChba2V5LCB2YWx1ZV0pID0+IGtleSkpXG5cdFx0XHQuZ3JvdXBCeShrZXkgPT4ga2V5KVxuXHRcdFx0LmZpbHRlcigoeyBrZXksIHJvd3MgfSkgPT4gcm93cy5sZW5ndGggPiAyKVxuXHRcdFx0Lm1hcCgoeyBrZXksIHJvd3MgfSkgPT4ga2V5KVxuXHRcdFx0LnZhbHVlcztcblx0fVxufVxuIl0sCiAgIm1hcHBpbmdzIjogIjs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBLHNCQUF1STtBQUV2SSxJQUFNLFVBQU4sTUFBYztBQUFBLEVBSWIsWUFBWSxRQUFnQixlQUF3QjtBQUNuRCxTQUFLLFNBQVM7QUFDZCxTQUFLLGdCQUFnQjtBQUFBLEVBQ3RCO0FBQ0Q7QUFPQSxJQUFNLG1CQUFrRDtBQUFBLEVBQ3ZELFVBQVUsQ0FBQztBQUFBLEVBQ1gsZ0JBQWdCLENBQUM7QUFDbEI7QUFFQSxJQUFxQix3QkFBckIsY0FBbUQsdUJBQU87QUFBQSxFQUExRDtBQUFBO0FBQ0Msb0JBQXNCLENBQUM7QUFBQTtBQUFBLEVBSXZCLE1BQU0sU0FBUztBQUNkLFVBQU0sS0FBSyxhQUFhO0FBRXhCLFNBQUssSUFBSSxVQUFVLGNBQWMsTUFBTTtBQTlCekM7QUErQkcsV0FBSyxNQUFLLFVBQUssSUFBSSxRQUFRLFFBQVEsVUFBVSxNQUFuQyxtQkFBc0M7QUFBQSxJQUNqRCxDQUFDO0FBR0QsYUFBUyxXQUFXLEtBQUssVUFBVTtBQUNsQyxXQUFLLGVBQWUsUUFBUSxRQUFRLFFBQVEsYUFBYTtBQUFBLElBQzFEO0FBRUEsU0FBSyxpQkFBaUIsVUFBVSxXQUFXLE9BQU8sVUFBeUI7QUFDMUUsVUFBSSxNQUFNLFFBQVEsVUFBVSxLQUFLLE9BQU87QUFDdkMsY0FBTSxLQUFLLE1BQU0sc0JBQXNCLEtBQUs7QUFBQSxNQUM3QyxXQUFXLE1BQU0sUUFBUSxVQUFVLEtBQUssT0FBTztBQUM5QyxjQUFNLEtBQUssTUFBTSxzQkFBc0IsS0FBSztBQUFBLE1BQzdDO0FBQUEsSUFDRCxDQUFDO0FBR0QsU0FBSyxjQUFjLElBQUksaUJBQWlCLEtBQUssS0FBSyxJQUFJLENBQUM7QUFBQSxFQUN4RDtBQUFBLEVBRUEsV0FBVztBQUFBLEVBRVg7QUFBQSxFQUVBLE1BQU0sZUFBZTtBQUNwQixRQUFJLFlBQTJDLE9BQU8sT0FBTyxDQUFDLEdBQUcsa0JBQWtCLE1BQU0sS0FBSyxTQUFTLENBQUM7QUFFeEcsYUFBUyxDQUFDLFFBQVEsT0FBTyxLQUFLLFVBQVUsU0FBUyxRQUFRLEdBQUc7QUFDM0QsVUFBSSxnQkFBaUIsU0FBUyxVQUFVLGVBQWUsU0FDcEQsVUFBVSxlQUFlLE1BQU0sSUFDL0I7QUFDSCxVQUFJLEtBQUssU0FBUyxVQUFVLGdCQUFjLFdBQVcsVUFBVSxPQUFPLElBQUk7QUFDekUsYUFBSyxTQUFTLEtBQUssSUFBSSxRQUFRLFNBQVMsYUFBYSxDQUFDO0FBQUEsSUFDeEQ7QUFBQSxFQUNEO0FBQUEsRUFFQSxNQUFNLGVBQWU7QUFDcEIsUUFBSSxXQUEwQztBQUM5QyxhQUFTLFdBQVcsS0FBSyxVQUFVO0FBQ2xDLGVBQVMsU0FBUyxLQUFLLFFBQVEsTUFBTTtBQUNyQyxlQUFTLGVBQWUsS0FBSyxRQUFRLGFBQWE7QUFBQSxJQUNuRDtBQUNBLFVBQU0sS0FBSyxTQUFTLFFBQVE7QUFBQSxFQUM3QjtBQUFBLEVBRUEsZUFBZSxTQUFpQixlQUE4QjtBQUM3RCxTQUFLLFdBQVc7QUFBQSxNQUNmLElBQUksa0JBQWtCLEtBQUssZUFBZSxPQUFPO0FBQUEsTUFDakQsTUFBTSxhQUFhO0FBQUEsTUFDbkIsVUFBVSxZQUFZO0FBQ3JCLFlBQUksS0FBSyxPQUFPO0FBQ2YsZ0JBQU0sS0FBSyxNQUFNLFFBQVE7QUFDekIsZUFBSyxNQUFNLE1BQU07QUFBQSxRQUNsQjtBQUNBLGFBQUssUUFBUSxJQUFJLGVBQWUsS0FBSyxLQUFLLEtBQUssSUFBSSxTQUFTLGFBQWE7QUFDekUsY0FBTSxLQUFLLE1BQU0sS0FBSztBQUFBLE1BQ3ZCO0FBQUEsSUFDRCxDQUFDO0FBQUEsRUFDRjtBQUFBLEVBRUEsZ0JBQWdCLFNBQXVCO0FBQ3RDLFNBQUssY0FBYyxrQkFBa0IsS0FBSyxlQUFlLE9BQU8sR0FBRztBQUFBLEVBQ3BFO0FBQUEsRUFFQSxlQUFlLFNBQXlCO0FBQ3ZDLGNBQVUsUUFBUSxLQUFLO0FBQ3ZCLFFBQUksWUFBWTtBQUNoQixhQUFTLElBQUksR0FBRyxJQUFJLFFBQVEsUUFBUSxLQUFLO0FBQ3hDLG1CQUFjLFFBQVEsQ0FBQyxLQUFLLE1BQU8sTUFBTSxRQUFRLE9BQU8sQ0FBQztBQUFBLElBQzFEO0FBQ0EsV0FBTztBQUFBLEVBQ1I7QUFDRDtBQUdBLElBQU0saUJBQU4sY0FBNkIsc0JBQU07QUFBQSxFQVdsQyxZQUFZLEtBQVUsSUFBWSxTQUFpQixjQUF1QjtBQUN6RSxVQUFNLEdBQUc7QUFDVCxTQUFLLFVBQVU7QUFDZixTQUFLLGVBQWU7QUFFcEIsU0FBSyxZQUFZLElBQUksMEJBQVU7QUFDL0IsU0FBSyxXQUFXLEdBQUcsTUFBTSxFQUN2QixPQUFPLGFBQVcsUUFBUSxLQUFLLE9BQU8sQ0FBQyxFQUN2QyxLQUFLLGFBQVcsUUFBUSxLQUFLLE9BQU8sQ0FBQyxFQUNyQyxJQUFJLGNBQVk7QUFBQSxNQUNoQixNQUFNLFFBQVEsS0FBSztBQUFBLE1BQ25CLE1BQU0sUUFBUSxLQUFLO0FBQUEsTUFDbkIsU0FBUyxRQUFRLE9BQU87QUFBQSxJQUN6QixFQUFFO0FBQ0gsU0FBSyxTQUFTLENBQUM7QUFBQSxFQUNoQjtBQUFBLEVBRUEsTUFBTSxTQUF3QjtBQUM3QixVQUFNLEVBQUMsVUFBUyxJQUFJO0FBQ3BCLFNBQUssVUFBVSxLQUFLO0FBRXBCLFNBQUssU0FBUyx1Q0FBb0MsS0FBSyxVQUFVO0FBQ2pFLFNBQUssUUFBUSxTQUFTLGlCQUFpQjtBQUV2QyxLQUFFLEtBQUssV0FBVyxLQUFLLFNBQVUsSUFBSSxLQUFLLGtCQUFrQjtBQUM1RCxRQUFJLENBQUUsWUFBWSxVQUFXLElBQUksQ0FBRSxLQUFLLFdBQVcsS0FBSyxTQUFVLEVBQUUsSUFBSSxZQUFVLEtBQUssU0FBUyxNQUFNLENBQUM7QUFDdkcsUUFBSSxDQUFFLGFBQWEsV0FBWSxJQUFJLENBQUUsWUFBWSxVQUFXLEVBQUUsSUFBSSxhQUFXLEtBQUssSUFBSSxNQUFNLHNCQUFzQixRQUFRLElBQUksQ0FBQztBQUUvSCxRQUFJLENBQUUsY0FBYyxZQUFhLEtBQUssTUFBTSxRQUFRLElBQUk7QUFBQSxNQUN2RCxLQUFLLElBQUksTUFBTSxLQUFLLFdBQVc7QUFBQSxNQUMvQixLQUFLLElBQUksTUFBTSxLQUFLLFdBQVc7QUFBQSxJQUNoQyxDQUFDLEdBQUcsSUFBSSxlQUFhLEtBQUssaUJBQWlCLFNBQVMsQ0FBQztBQUVyRCxRQUFJLGFBQWEsVUFBVSxVQUFVO0FBQ3JDLGVBQVcsU0FBUyxvQkFBb0I7QUFHeEMsUUFBSSxlQUFlLElBQUksZ0NBQWdCLFVBQVUsRUFDL0MsU0FBUyxpQkFBaUIsRUFDMUIsUUFBUSxZQUFZLE1BQU0sS0FBSyxzQkFBc0IsS0FBSyxDQUFDLEVBQzNEO0FBRUYsUUFBSSxpQkFBaUIsaUNBQ25CO0FBQUEsTUFDQSxLQUFLO0FBQUEsTUFBSyxLQUFLLFdBQVc7QUFBQTtBQUFBLEVBQWM7QUFBQSxNQUN4QyxhQUFhLFVBQVUsRUFBRSxLQUFLLDRCQUE0QixDQUFDO0FBQUEsTUFDM0QsV0FBVztBQUFBLE1BQ1gsS0FBSztBQUFBLElBQ047QUFFRCxRQUFJLGFBQWEsSUFBSSxnQ0FBZ0IsVUFBVSxFQUM3QyxTQUFTLGlCQUFpQixFQUMxQixRQUFRLFlBQVksTUFBTSxLQUFLLHNCQUFzQixLQUFLLENBQUMsRUFDM0Q7QUFFRixRQUFJLGVBQWUsaUNBQ2pCO0FBQUEsTUFDQSxLQUFLO0FBQUEsTUFBSyxLQUFLLFdBQVc7QUFBQTtBQUFBLEVBQWM7QUFBQSxNQUN4QyxXQUFXLFVBQVUsRUFBRSxLQUFLLDRCQUE0QixDQUFDO0FBQUEsTUFDekQsV0FBVztBQUFBLE1BQ1gsS0FBSztBQUFBLElBQ047QUFFRCxVQUFNLFFBQVEsSUFBSSxDQUFFLGdCQUFnQixZQUFhLENBQUM7QUFBQSxFQUNuRDtBQUFBLEVBRUEsTUFBTSxVQUF5QjtBQUM5QixVQUFNLEVBQUMsVUFBUyxJQUFJO0FBQ3BCLGNBQVUsTUFBTTtBQUVoQixTQUFLLFVBQVUsT0FBTztBQUV0QixRQUFJLENBQUMsS0FBSztBQUFRO0FBRWxCLFFBQUksU0FBUyxLQUFLLE9BQU8sSUFBSSxZQUFVLEtBQUssU0FBUyxNQUFNLENBQUMsRUFDMUQsSUFBSSxDQUFDLEVBQUUsTUFBTSxNQUFNLFFBQVEsTUFBTTtBQUNqQyxVQUFJLFdBQVcsS0FBSyxJQUFJLE1BQU0sc0JBQXNCLElBQUk7QUFFeEQsYUFBTyxLQUFLLElBQUksWUFBWSxtQkFBbUIsVUFBVSxDQUFDLGdCQUFnQjtBQUN6RSxvQkFBWSxLQUFLLE9BQU8sSUFBSTtBQUFBLE1BQzdCLENBQUM7QUFBQSxJQUNGLENBQUM7QUFFRixVQUFNLFFBQVEsSUFBSSxNQUFNO0FBQUEsRUFDekI7QUFBQSxFQUVBLE1BQU0sc0JBQXNCLEtBQUs7QUFDaEMsUUFBSSxjQUFlLE9BQU8sUUFBUyxLQUFLLFlBQVksS0FBSztBQUN6RCxRQUFJLGFBQWMsT0FBTyxRQUFTLEtBQUssWUFBWSxLQUFLO0FBRXhELFFBQUksZUFBZSxLQUFLLFNBQVMsV0FBVyxFQUFFO0FBQzlDLFFBQUksY0FBYyxLQUFLLFNBQVMsVUFBVSxFQUFFO0FBRTVDLFFBQUksS0FBSyxZQUFZLFNBQVMsY0FBYyxFQUFFLEdBQUcsU0FBUyxhQUFhLEVBQUUsQ0FBQyxHQUFHO0FBQzVFLFdBQUssU0FBUyxXQUFXLEVBQUUsU0FBUyxJQUFJO0FBQ3hDLFdBQUssU0FBUyxVQUFVLEVBQUUsU0FBUyxJQUFJO0FBQUEsSUFFeEM7QUFFQSxVQUFNLEtBQUssUUFBUTtBQUNuQixTQUFLLE9BQU87QUFBQSxFQUNiO0FBQUEsRUFFQSxZQUFZLGNBQWMsYUFBYTtBQUN0QyxRQUFJLEtBQUs7QUFBYyxhQUFPLGVBQWU7QUFDN0MsV0FBTyxlQUFlO0FBQUEsRUFDdkI7QUFBQSxFQUVBLGlCQUFpQixXQUEyQjtBQUMzQyxRQUFJLFVBQVUsTUFBTSxHQUFHLENBQUMsS0FBSztBQUM1QixhQUFPO0FBQ1IsZ0JBQVksVUFBVSxNQUFNLENBQUM7QUFFN0IsUUFBSSxTQUFTLFVBQVUsUUFBUSxLQUFLO0FBQ3BDLGNBQVUsVUFBVSxNQUFNLE1BQU0sRUFBRSxRQUFRLElBQUksSUFBSTtBQUVsRCxXQUFPLFVBQVUsTUFBTSxNQUFNO0FBQUEsRUFDOUI7QUFBQSxFQUVBLG9CQUFvQjtBQUNuQixRQUFJLGlCQUFpQjtBQUVyQixPQUFHO0FBQ0ksd0JBQWtCLEtBQUssTUFBTSxLQUFLLE9BQU8sSUFBSSxLQUFLLFNBQVMsTUFBTTtBQUN2RSx5QkFBbUIsbUJBQW1CLElBQUksSUFBSSxrQkFBa0I7QUFBQSxJQUVqRSxTQUNDLEtBQUssT0FBTyxTQUFTLE1BQ2xCLEtBQUssT0FBTyxDQUFDLEtBQUssbUJBQW1CLEtBQUssT0FBTyxDQUFDLEtBQUssb0JBQ3ZELEtBQUssT0FBTyxDQUFDLEtBQUssbUJBQW1CLEtBQUssT0FBTyxDQUFDLEtBQUs7QUFHM0QsU0FBSyxPQUFPLENBQUMsSUFBSTtBQUNqQixTQUFLLE9BQU8sQ0FBQyxJQUFJO0FBRWpCLFFBQUksWUFBWSxLQUFLLGVBQ2xCLEtBQUssU0FBUyxlQUFlLEVBQUUsVUFBVSxLQUFLLFNBQVMsZ0JBQWdCLEVBQUUsVUFDekUsS0FBSyxTQUFTLGVBQWUsRUFBRSxVQUFVLEtBQUssU0FBUyxnQkFBZ0IsRUFBRTtBQUU1RSxXQUFPLFlBQ0osQ0FBQyxpQkFBaUIsZ0JBQWdCLElBQ2xDLENBQUMsa0JBQWtCLGVBQWU7QUFBQSxFQUVuQztBQUNKO0FBRUEsSUFBTSxtQkFBTixjQUErQixpQ0FBaUI7QUFBQSxFQUcvQyxZQUFZLEtBQVUsUUFBK0I7QUFDcEQsVUFBTSxLQUFLLE1BQU07QUFDakIsU0FBSyxTQUFTO0FBQUEsRUFDZjtBQUFBLEVBRUEsVUFBZ0I7QUFDZixVQUFNLEVBQUMsWUFBVyxJQUFJO0FBQ3RCLGdCQUFZLE1BQU07QUFFbEIsZ0JBQVksU0FBUyxNQUFNLEVBQUUsTUFBTSxtQkFBZ0IsQ0FBQztBQUVwRCxRQUFJLENBQUMsS0FBSyxPQUFPLElBQUk7QUFDcEIsa0JBQVksU0FBUyxRQUFRLEVBQUUsTUFBTSxpQ0FBaUMsQ0FBQztBQUN2RTtBQUFBLElBQ0Q7QUFFQSxRQUFJLG1CQUFtQixLQUFLLGdCQUFnQjtBQUM1QyxRQUFJLGlCQUFpQixVQUFVLEdBQUc7QUFDakMsa0JBQVksU0FBUyxRQUFRLEVBQUUsTUFBTSx1Q0FBdUMsQ0FBQztBQUM3RTtBQUFBLElBQ0Q7QUFFQSxRQUFJLEtBQUssT0FBTyxTQUFTLFNBQVMsR0FBRztBQUNwQyxlQUFTLENBQUMsUUFBUSxPQUFPLEtBQUssS0FBSyxPQUFPLFNBQVMsUUFBUSxHQUFHO0FBQzdELFlBQUksd0JBQVEsV0FBVyxFQUNyQixRQUFRLFlBQVksU0FBUyxHQUFHLEVBQ2hDLFFBQVEsZUFBZ0IsRUFDeEI7QUFBQSxVQUFVLFlBQVUsT0FDbkIsU0FBUyxRQUFRLGFBQWEsRUFDOUIsV0FBVyw0QkFBNEIsRUFDdkMsU0FBUyxPQUFPLFVBQVU7QUFDMUIsZ0JBQUksZUFBZSxLQUFLLE9BQU8sU0FBUyxNQUFNO0FBQzlDLGlCQUFLLE9BQU8sZ0JBQWdCLGFBQWEsTUFBTTtBQUUvQyxpQkFBSyxPQUFPLFNBQVMsTUFBTSxJQUFJLElBQUksUUFBUSxhQUFhLFFBQVEsS0FBSztBQUNyRSxpQkFBSyxPQUFPLGVBQWUsYUFBYSxRQUFRLEtBQUs7QUFDckQsa0JBQU0sS0FBSyxPQUFPLGFBQWE7QUFBQSxVQUNoQyxDQUFDO0FBQUEsUUFDRixFQUNDLFlBQVksY0FBWTtBQUN4QixtQkFBUyxnQkFBZ0Isa0JBQWtCO0FBQzFDLGdCQUFJLGdCQUFnQixRQUFRLFVBQVUsS0FBSyxPQUFPLFNBQVMsVUFBVSxPQUFLLEVBQUUsVUFBVSxZQUFZLEtBQUs7QUFDdEc7QUFFRCx1QkFBVyxTQUFTLFVBQVUsY0FBYyxZQUFZO0FBQUEsVUFDekQ7QUFFQSxpQkFBTyxTQUFTLFNBQVMsT0FBTyxVQUFVO0FBQ3pDLGdCQUFJLGVBQWUsS0FBSyxPQUFPLFNBQVMsTUFBTTtBQUM5QyxpQkFBSyxPQUFPLGdCQUFnQixhQUFhLE1BQU07QUFFL0MsaUJBQUssT0FBTyxTQUFTLE1BQU0sSUFBSSxJQUFJLFFBQVEsT0FBTyxhQUFhLGFBQWE7QUFDNUUsaUJBQUssT0FBTyxlQUFlLE9BQU8sYUFBYSxhQUFhO0FBQzVELGtCQUFNLEtBQUssT0FBTyxhQUFhO0FBQUEsVUFDaEMsQ0FBQyxFQUFFLFNBQVMsUUFBUSxNQUFNO0FBQUEsUUFDM0IsQ0FBQztBQUFBLE1BQ0g7QUFBQSxJQUNEO0FBRUEsUUFBSSxVQUFVLFlBQVksVUFBVTtBQUNwQyxZQUFRLFNBQVMsaUJBQWlCO0FBRWxDLFFBQUksS0FBSyxPQUFPLFNBQVMsU0FBUyxHQUFHO0FBQ3BDLFVBQUksZ0NBQWdCLE9BQU8sRUFDekIsU0FBUyxlQUFlLEVBQ3hCLGNBQWMscUJBQWtCLEVBQ2hDLFdBQVcsU0FBUyxFQUNwQixRQUFRLFlBQVk7QUFDcEIsWUFBSSx1QkFBTyxZQUFZO0FBQ3ZCLFlBQUksVUFBVSxLQUFLLE9BQU8sU0FBUyxJQUFJO0FBQ3ZDLFlBQUksV0FBVyxRQUFRLE9BQU8sS0FBSyxLQUFLLElBQUk7QUFDM0MsZUFBSyxPQUFPLGdCQUFnQixRQUFRLE1BQU07QUFBQSxRQUMzQztBQUVBLGNBQU0sS0FBSyxPQUFPLGFBQWE7QUFDL0IsYUFBSyxRQUFRO0FBQUEsTUFDZCxDQUFDO0FBQUEsSUFDSDtBQUVBLFFBQUksaUJBQWlCLFNBQVMsS0FBSyxPQUFPLFNBQVMsUUFBUTtBQUMxRCxVQUFJLGdDQUFnQixPQUFPLEVBQ3pCLFNBQVMsZUFBZSxFQUN4QixjQUFjLG9CQUFpQixFQUMvQixXQUFXLFNBQVMsRUFDcEIsUUFBUSxZQUFZO0FBQ3BCLFlBQUksdUJBQU8sV0FBVztBQUN0QixZQUFJLGlCQUFpQixpQkFDbkIsS0FBSyxhQUFXLEtBQUssT0FBTyxTQUFTLFVBQVUsT0FBSyxFQUFFLFVBQVUsT0FBTyxDQUFDO0FBQzFFLGFBQUssT0FBTyxTQUFTLEtBQUssSUFBSSxRQUFRLGlCQUFpQixpQkFBaUIsSUFBSSxLQUFLLENBQUM7QUFDbEYsYUFBSyxPQUFPLGVBQWUsaUJBQWlCLGlCQUFpQixJQUFJLEtBQUs7QUFDdEUsY0FBTSxLQUFLLE9BQU8sYUFBYTtBQUMvQixhQUFLLFFBQVE7QUFBQSxNQUNkLENBQUM7QUFBQSxJQUNIO0FBQUEsRUFDRDtBQUFBLEVBRUEsa0JBQTRCO0FBMVc3QjtBQTJXRSxZQUFPLFVBQUssT0FBTyxPQUFaLG1CQUFnQixRQUNyQixRQUFRLGFBQVcsT0FBTyxRQUFRLFFBQVEsS0FBSyxXQUFXLEVBQzFELElBQUksQ0FBQyxDQUFDLEtBQUssS0FBSyxNQUFNLEdBQUcsR0FDekIsUUFBUSxTQUFPLEtBQ2YsT0FBTyxDQUFDLEVBQUUsS0FBSyxLQUFLLE1BQU0sS0FBSyxTQUFTLEdBQ3hDLElBQUksQ0FBQyxFQUFFLEtBQUssS0FBSyxNQUFNLEtBQ3ZCO0FBQUEsRUFDSDtBQUNEOyIsCiAgIm5hbWVzIjogW10KfQo=
